{% extends 'base.html' %}
{% load static %}

{% block title %}{{ target_user.first_name|default:target_user.username }} ê°•ì‚¬ ëŒ€ì‹œë³´ë“œ{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'teacherpage/css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="profile-container surface">

  <!-- ìƒë‹¨ í”„ë¡œí•„ -->
  <div class="profile-header">
    <div class="profile-info-group">
      <img class="profile-avatar"
           src="{% if target_user.profile_image %}
                    {{ target_user.profile_image.url }}
                {% else %}
                    {% static 'images/default_thumbnail.png' %}
                {% endif %}"
           alt="í”„ë¡œí•„">
      <div>
        <h2 class="profile-name">{{ target_user.first_name|default:target_user.username }}</h2>
        <p class="profile-username subtext">@{{ target_user.username }} Â· ê°•ì‚¬</p>
      </div>
    </div>

    <div class="header-actions">
      <a class="btn-outline" href="{% url 'course:course_create' %}">ê°•ì˜ ë“±ë¡</a>
    </div>
  </div>

    <div class="stat-grid">

    <a href="{% url 'course:my_courses' %}" class="stat-box-link">
        <div class="stat-box surface no-shadow">
        <span class="stat-label">ğŸ“š ë‚´ ê°•ì˜</span>
        <p class="stat-value">{{ total_courses|default:"0" }}ê°œ</p>
        </div>
    </a>

    <a href="{% url 'teacherpage:students_all' %}" class="stat-box-link">
        <div class="stat-box surface no-shadow">
        <span class="stat-label">ğŸ‘¥ ì „ì²´ ìˆ˜ê°•ìƒ(ì¤‘ë³µ ì œì™¸)</span>
        <p class="stat-value">{{ total_students|default:"0" }}ëª…</p>
        </div>
    </a>

    </div>

  <!-- ê°•ì‚¬ ì†Œê°œ -->
  <div class="section-header">
    <span class="section-title">ê°•ì‚¬ ì†Œê°œ</span>
    {% if request.user == target_user %}
    {% endif %}
  </div>

  <div class="bio-box surface no-shadow">
    <div id="bio-display">
      {% if target_user.bio %}
        <div class="bio-text">{{ target_user.bio }}</div>
      {% else %}
        <p class="bio-empty muted">ê°•ì‚¬ ì†Œê°œê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ê°•ìƒì—ê²Œ ì†Œê°œë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!</p>
      {% endif %}
    </div>

    {% if request.user == target_user %}
    <form method="POST" action="{% url 'teacherpage:dashboard' %}">
      {% csrf_token %}
      <textarea name="bio" id="bio-input" class="bio-textarea" rows="5">{{ target_user.bio }}</textarea>

      <div id="btn-group" class="btn-group">
        <button type="submit" class="btn-save">ì €ì¥í•˜ê¸°</button>
        <button type="button" class="btn-gray" id="bioCancelBtn">ì·¨ì†Œ</button>
      </div>
    </form>
    {% endif %}
  </div>

  <!-- ê°•ì˜ ê´€ë¦¬ -->
  <div class="section-header section-gap">
    <span class="section-title">ê°•ì˜ ê´€ë¦¬</span>
  </div>

  <div class="course-list">
    {% for course in my_courses %}
      <div class="course-card">
        <div class="course-left">
          {% if course.thumbnail %}
            <img class="thumb" src="{{ course.thumbnail.url }}" alt="ì¸ë„¤ì¼">
          {% else %}
            <img class="thumb" src="{% static 'images/default_thumbnail.png' %}" alt="ê¸°ë³¸ ì¸ë„¤ì¼">
          {% endif %}

          <div class="course-meta">
            <p class="course-title">{{ course.title }}</p>
            <div class="course-sub">
              <span class="pill">ê°€ê²©: {{ course.price }}</span>
              <span class="pill">ìˆ˜ê°•ìƒ: {{ course.student_count|default:"0" }}ëª…</span>
              {% if course.video %}
                <span class="pill">ì˜ìƒ: ë“±ë¡ë¨</span>
              {% endif %}
              <span class="pill">ë“±ë¡ì¼: {{ course.created_at|date:"Y-m-d" }}</span>
            </div>
          </div>
        </div>

        <div class="course-actions">
          {% if course.unread_chat_count|default:0 > 0 %}
            <span class="msg-indicator" title="ìƒˆ ë©”ì‹œì§€ ìˆìŒ">ğŸ’¬<span class="dot"></span></span>
          {% else %}
            <span class="msg-indicator muted" title="ìƒˆ ë©”ì‹œì§€ ì—†ìŒ">ğŸ’¬</span>
          {% endif %}

          <a class="btn-sm" href="{% url 'teacherpage:course_students' course.id %}">ìˆ˜ê°•ìƒ</a>
          <a class="btn-sm" href="{% url 'course:course_update' course.id %}">ìˆ˜ì •</a>
          <a class="btn-danger-sm" href="{% url 'teacherpage:course_delete' course.id %}">ì‚­ì œ</a>
        </div>
      </div>
    {% empty %}
      <div class="empty-box soft">
        <p class="muted">ì•„ì§ ë“±ë¡í•œ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒë‹¨ì˜ â€œê°•ì˜ ë“±ë¡â€ìœ¼ë¡œ ì‹œì‘í•´ë³´ì„¸ìš”.</p>
      </div>
    {% endfor %}
  </div>

  <!-- ê³µí†µ ì•¡ì…˜(ë³¸ì¸ë§Œ) -->
  {% if request.user == target_user %}
  <div class="action-fixed">
    <a href="{% url 'common:profile_edit' %}" class="btn-save">ë‚´ ì •ë³´ ìˆ˜ì •</a>
    <a href="{% url 'common:password_change' %}" class="btn-outline">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a>
    <button type="button" class="btn-danger" id="deleteOpenBtn">íšŒì›íƒˆí‡´</button>
  </div>
  {% endif %}

</div>

{% if request.user == target_user %}
<div id="deleteOverlay" class="confirm-overlay" aria-hidden="true">
  <div class="confirm-modal surface">
    <h3 class="confirm-title">ì •ë§ íƒˆí‡´í•˜ì‹œê² ì–´ìš”?</h3>
    <p class="confirm-desc muted">
      íƒˆí‡´í•˜ë©´ ê³„ì • ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.<br>
      ì§„í–‰ ì¤‘ì¸ ë°ì´í„°ê°€ ì‚­ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </p>

    <form method="POST" action="{% url 'common:delete_account' %}">
      {% csrf_token %}
      <div class="confirm-actions">
        <button type="button" class="btn-ghost" id="deleteCancelBtn">ì·¨ì†Œ</button>
        <button type="submit" class="btn-danger-solid">íƒˆí‡´í•˜ê¸°</button>
      </div>
    </form>
  </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script src="{% static 'teacherpage/js/dashboard.js' %}"></script>
{% endblock %}